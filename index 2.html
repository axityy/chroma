<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STAKE.GG ‚Äî Premium Token Casino</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0b0f;
    --bg2: #10121a;
    --bg3: #161925;
    --bg4: #1e2235;
    --card: #12151f;
    --border: #1e2337;
    --accent: #6c63ff;
    --accent2: #8b5cf6;
    --gold: #f59e0b;
    --gold2: #fbbf24;
    --green: #10b981;
    --red: #ef4444;
    --text: #e2e8f0;
    --text2: #8892a4;
    --text3: #4a5568;
    --glow: rgba(108,99,255,0.3);
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* BACKGROUND GRID */
  body::before {
    content:'';
    position:fixed;
    inset:0;
    background-image:
      linear-gradient(rgba(108,99,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(108,99,255,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events:none;
    z-index:0;
  }

  /* SIDEBAR */
  .sidebar {
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 220px;
    background: var(--bg2);
    border-right: 1px solid var(--border);
    z-index: 100;
    display: flex;
    flex-direction: column;
    padding: 0 0 20px;
  }

  .logo {
    padding: 24px 20px;
    font-family: 'Rajdhani', sans-serif;
    font-size: 26px;
    font-weight: 700;
    letter-spacing: 2px;
    background: linear-gradient(135deg, var(--accent), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    border-bottom: 1px solid var(--border);
  }
  .logo span { color: var(--gold); }

  .nav-section {
    padding: 16px 12px 8px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 2px;
    color: var(--text3);
    text-transform: uppercase;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 16px;
    margin: 2px 8px;
    border-radius: 10px;
    cursor: pointer;
    color: var(--text2);
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s;
    border: 1px solid transparent;
  }
  .nav-item:hover { background: var(--bg3); color: var(--text); }
  .nav-item.active {
    background: linear-gradient(135deg, rgba(108,99,255,0.2), rgba(139,92,246,0.1));
    border-color: rgba(108,99,255,0.3);
    color: var(--accent);
  }
  .nav-item .icon { font-size: 18px; width: 22px; text-align:center; }

  .sidebar-footer {
    margin-top: auto;
    padding: 16px;
    border-top: 1px solid var(--border);
  }

  /* TOPBAR */
  .topbar {
    position: fixed;
    top: 0; left: 220px; right: 0;
    height: 64px;
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    z-index: 99;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
  }

  .balance-display {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--bg3);
    padding: 8px 16px;
    border-radius: 10px;
    border: 1px solid var(--border);
    font-family: 'Rajdhani', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: var(--gold);
  }
  .balance-display .label { color: var(--text2); font-size: 11px; font-family: 'DM Sans'; font-weight: 400; }

  .btn {
    padding: 9px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
    box-shadow: 0 4px 15px rgba(108,99,255,0.3);
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(108,99,255,0.4); }
  .btn-gold {
    background: linear-gradient(135deg, var(--gold), var(--gold2));
    color: #0a0b0f;
    box-shadow: 0 4px 15px rgba(245,158,11,0.3);
  }
  .btn-gold:hover { transform: translateY(-1px); }
  .btn-outline {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text2);
  }
  .btn-outline:hover { border-color: var(--accent); color: var(--accent); }
  .btn-green {
    background: linear-gradient(135deg, #059669, var(--green));
    color: white;
    box-shadow: 0 4px 15px rgba(16,185,129,0.3);
  }
  .btn-red {
    background: linear-gradient(135deg, #dc2626, var(--red));
    color: white;
  }
  .btn-sm { padding: 6px 14px; font-size: 13px; }

  .user-avatar {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--gold));
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    cursor: pointer;
    border: 2px solid var(--border);
    overflow: hidden;
  }
  .user-avatar img { width: 100%; height: 100%; object-fit: cover; }

  /* MAIN */
  .main {
    margin-left: 220px;
    margin-top: 64px;
    padding: 32px;
    position: relative;
    z-index: 1;
    min-height: calc(100vh - 64px);
  }

  .page { display: none; }
  .page.active { display: block; }

  /* CARDS */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
  }

  /* HOME */
  .hero {
    background: linear-gradient(135deg, rgba(108,99,255,0.15), rgba(245,158,11,0.08));
    border: 1px solid rgba(108,99,255,0.2);
    border-radius: 20px;
    padding: 48px;
    margin-bottom: 32px;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content:'';
    position: absolute;
    top: -50%; right: -10%;
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(108,99,255,0.15), transparent 70%);
    pointer-events: none;
  }
  .hero h1 {
    font-family: 'Rajdhani', sans-serif;
    font-size: 52px;
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 12px;
  }
  .hero h1 .highlight {
    background: linear-gradient(135deg, var(--accent), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .hero p { color: var(--text2); font-size: 16px; max-width: 500px; margin-bottom: 24px; }

  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .game-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px 20px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    text-align: center;
  }
  .game-card::before {
    content:'';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--accent-card, rgba(108,99,255,0.1)), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .game-card:hover { border-color: rgba(108,99,255,0.4); transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.3); }
  .game-card:hover::before { opacity: 1; }
  .game-card .game-icon { font-size: 42px; margin-bottom: 12px; display: block; }
  .game-card .game-name {
    font-family: 'Rajdhani', sans-serif;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: 1px;
  }
  .game-card .game-desc { color: var(--text2); font-size: 12px; }
  .game-card .badge {
    position: absolute; top: 12px; right: 12px;
    background: var(--green); color: white;
    font-size: 10px; font-weight: 700;
    padding: 2px 8px; border-radius: 20px;
    letter-spacing: 0.5px;
  }
  .badge-hot { background: var(--red) !important; }
  .badge-new { background: var(--accent) !important; }

  /* INPUT */
  .input-group { margin-bottom: 16px; }
  .input-group label {
    display: block;
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 6px;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .input-field {
    width: 100%;
    padding: 10px 14px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-field:focus { border-color: var(--accent); }
  .input-with-btn { display: flex; gap: 8px; }
  .input-with-btn .input-field { flex: 1; }
  .bet-btns { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
  .bet-btn {
    padding: 5px 12px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text2);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
  }
  .bet-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* GAME LAYOUT */
  .game-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 20px;
    align-items: start;
  }
  .game-controls {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    position: sticky;
    top: 84px;
  }
  .game-area {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    min-height: 500px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .game-title {
    font-family: 'Rajdhani', sans-serif;
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
    letter-spacing: 1px;
  }

  /* RESULT OVERLAY */
  .result-badge {
    padding: 12px 24px;
    border-radius: 50px;
    font-family: 'Rajdhani', sans-serif;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 2px;
    animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    margin: 16px 0;
  }
  .result-win { background: linear-gradient(135deg, #065f46, #059669); border: 2px solid var(--green); color: var(--green); }
  .result-lose { background: linear-gradient(135deg, #7f1d1d, #dc2626); border: 2px solid var(--red); color: var(--red); }
  @keyframes popIn {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  /* ===== MINES ===== */
  .mines-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    max-width: 420px;
    width: 100%;
  }
  .mine-cell {
    aspect-ratio: 1;
    background: var(--bg3);
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    transition: all 0.15s;
    position: relative;
    overflow: hidden;
  }
  .mine-cell:hover:not(.revealed) {
    background: var(--bg4);
    border-color: rgba(108,99,255,0.5);
    transform: scale(1.05);
  }
  .mine-cell.revealed-gem {
    background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.1));
    border-color: var(--green);
    animation: gemReveal 0.3s ease;
  }
  .mine-cell.revealed-bomb {
    background: linear-gradient(135deg, rgba(239,68,68,0.3), rgba(185,28,28,0.1));
    border-color: var(--red);
    animation: bombReveal 0.3s ease;
  }
  .mine-cell.auto-reveal { opacity: 0.7; }
  @keyframes gemReveal {
    0% { transform: scale(0.5) rotate(-10deg); }
    60% { transform: scale(1.15) rotate(3deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  @keyframes bombReveal {
    0% { transform: scale(0.5); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  .mines-multiplier {
    font-family: 'Rajdhani', sans-serif;
    font-size: 36px;
    font-weight: 700;
    color: var(--gold);
    margin-bottom: 8px;
  }
  .mines-profit {
    color: var(--green);
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 20px;
  }

  /* ===== JACKPOT WHEEL ===== */
  .jackpot-container { width: 100%; max-width: 600px; }
  .wheel-wrapper {
    position: relative;
    width: 380px;
    height: 380px;
    margin: 0 auto 24px;
  }
  #jackpotCanvas { border-radius: 50%; }
  .wheel-pointer {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: var(--bg2);
    border: 3px solid var(--border);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    z-index: 10;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  .wheel-tick {
    position: absolute;
    top: -16px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 20px solid var(--gold);
    filter: drop-shadow(0 0 6px var(--gold));
    z-index: 11;
  }
  .jackpot-players {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
  }
  .jackpot-player {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: var(--bg3);
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  .player-color-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .player-chance {
    margin-left: auto;
    font-family: 'Rajdhani', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--gold);
  }
  .jackpot-total {
    text-align: center;
    margin-bottom: 16px;
  }
  .jackpot-total .amount {
    font-family: 'Rajdhani', sans-serif;
    font-size: 42px;
    font-weight: 700;
    color: var(--gold);
    display: block;
  }
  .jackpot-total .label { color: var(--text2); font-size: 13px; }
  .jackpot-status {
    text-align: center;
    padding: 10px;
    background: var(--bg3);
    border-radius: 8px;
    color: var(--text2);
    font-size: 13px;
    margin-bottom: 16px;
  }

  /* ===== ROULETTE ===== */
  .roulette-track-wrapper {
    width: 100%;
    overflow: hidden;
    position: relative;
    border-radius: 12px;
    border: 2px solid var(--border);
    background: var(--bg3);
    margin-bottom: 24px;
  }
  .roulette-track-wrapper::before,
  .roulette-track-wrapper::after {
    content:'';
    position: absolute;
    top: 0; bottom: 0;
    width: 80px;
    z-index: 2;
    pointer-events: none;
  }
  .roulette-track-wrapper::before {
    left: 0;
    background: linear-gradient(to right, var(--bg3), transparent);
  }
  .roulette-track-wrapper::after {
    right: 0;
    background: linear-gradient(to left, var(--bg3), transparent);
  }
  .roulette-indicator {
    position: absolute;
    top: 0; bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 3px;
    background: var(--gold);
    z-index: 3;
    box-shadow: 0 0 10px var(--gold);
  }
  .roulette-track {
    display: flex;
    gap: 6px;
    padding: 12px;
    width: max-content;
    transition: transform 6s cubic-bezier(0.15, 0.5, 0.3, 1);
  }
  .roulette-item {
    width: 80px;
    height: 80px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    font-family: 'Rajdhani', sans-serif;
    flex-shrink: 0;
    border: 2px solid transparent;
  }
  .roulette-item.red { background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.4); color: #ef4444; }
  .roulette-item.black { background: rgba(30,34,53,0.8); border-color: rgba(100,100,120,0.4); color: var(--text2); }
  .roulette-item.green { background: rgba(16,185,129,0.2); border-color: rgba(16,185,129,0.4); color: var(--green); }
  .roulette-bets {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
  }
  .roulette-bet-btn {
    padding: 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    cursor: pointer;
    text-align: center;
    font-family: 'Rajdhani', sans-serif;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 1px;
    transition: all 0.2s;
  }
  .roulette-bet-btn.bet-red {
    background: rgba(239,68,68,0.1);
    border-color: rgba(239,68,68,0.3);
    color: var(--red);
  }
  .roulette-bet-btn.bet-red:hover, .roulette-bet-btn.bet-red.selected {
    background: rgba(239,68,68,0.25);
    border-color: var(--red);
  }
  .roulette-bet-btn.bet-black {
    background: rgba(50,55,80,0.3);
    border-color: rgba(100,110,140,0.3);
    color: var(--text);
  }
  .roulette-bet-btn.bet-black:hover, .roulette-bet-btn.bet-black.selected {
    background: rgba(80,90,120,0.4);
    border-color: var(--text2);
  }
  .roulette-bet-btn.bet-green {
    background: rgba(16,185,129,0.1);
    border-color: rgba(16,185,129,0.3);
    color: var(--green);
  }
  .roulette-bet-btn.bet-green:hover, .roulette-bet-btn.bet-green.selected {
    background: rgba(16,185,129,0.25);
    border-color: var(--green);
  }
  .roulette-bet-btn .mult { display:block; font-size:12px; font-family:'DM Sans'; color: var(--text2); font-weight: 400; margin-top: 2px; }

  /* ===== DICE ===== */
  .dice-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 24px;
  }
  .dice-face {
    width: 100px;
    height: 100px;
    background: var(--bg3);
    border: 2px solid var(--border);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 52px;
    transition: all 0.3s;
    position: relative;
  }
  .dice-face.rolling { animation: diceRoll 0.15s ease-in-out infinite; }
  @keyframes diceRoll {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(0.9); }
    100% { transform: rotate(360deg) scale(1); }
  }
  .dice-result {
    font-family: 'Rajdhani', sans-serif;
    font-size: 60px;
    font-weight: 700;
    color: var(--text);
  }
  .dice-vs { font-size: 14px; color: var(--text2); font-weight: 600; }
  .dice-slider-wrap { padding: 0 8px; margin-bottom: 20px; }
  .dice-slider { width: 100%; position: relative; }
  .dice-range {
    width: 100%;
    -webkit-appearance: none;
    height: 6px;
    border-radius: 6px;
    background: linear-gradient(to right, var(--green) 0%, var(--green) var(--val, 50%), var(--red) var(--val, 50%), var(--red) 100%);
    outline: none;
    cursor: pointer;
  }
  .dice-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px; height: 22px;
    border-radius: 50%;
    background: white;
    border: 3px solid var(--accent);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(108,99,255,0.4);
  }
  .dice-info {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 12px;
    color: var(--text2);
  }
  .dice-info .val {
    font-family: 'Rajdhani', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
  }

  /* ===== TOWER ===== */
  .tower-grid {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    width: 100%;
    max-width: 380px;
  }
  .tower-row {
    display: flex;
    gap: 8px;
    width: 100%;
    justify-content: center;
  }
  .tower-cell {
    width: 80px;
    height: 52px;
    border-radius: 8px;
    background: var(--bg3);
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    transition: all 0.15s;
    position: relative;
  }
  .tower-cell.active-row { border-color: rgba(108,99,255,0.5); background: rgba(108,99,255,0.1); }
  .tower-cell.active-row:hover { transform: scale(1.05); border-color: var(--accent); }
  .tower-cell.safe { background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.1)); border-color: var(--green); }
  .tower-cell.bomb-hit { background: linear-gradient(135deg, rgba(239,68,68,0.3), rgba(185,28,28,0.1)); border-color: var(--red); }
  .tower-cell.passed { opacity: 0.5; }
  .tower-cell.blocked { cursor: default; }
  .tower-level {
    position: absolute;
    left: -36px;
    font-size: 11px;
    color: var(--text3);
    font-weight: 600;
    width: 30px;
    text-align: right;
  }
  .tower-mult {
    font-family: 'Rajdhani', sans-serif;
    font-size: 36px;
    font-weight: 700;
    color: var(--gold);
    margin-bottom: 8px;
    text-align: center;
  }

  /* ===== CASE OPENING ===== */
  .case-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }
  .case-item {
    aspect-ratio: 1;
    background: var(--bg3);
    border: 2px solid var(--border);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    padding: 12px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .case-item::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 3px;
    background: var(--rarity-color, var(--border));
  }
  .case-item:hover { transform: translateY(-4px); border-color: rgba(108,99,255,0.4); }
  .case-item .case-emoji { font-size: 36px; margin-bottom: 8px; }
  .case-item .case-name { font-size: 12px; font-weight: 600; color: var(--text2); margin-bottom: 4px; }
  .case-item .case-price {
    font-family: 'Rajdhani', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--gold);
  }
  .case-item .rarity-label {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--rarity-color, var(--text3));
  }
  .open-animation-wrapper {
    width: 100%;
    overflow: hidden;
    border-radius: 12px;
    border: 2px solid var(--border);
    background: var(--bg3);
    margin-bottom: 24px;
    position: relative;
  }
  .open-track {
    display: flex;
    gap: 8px;
    padding: 16px;
    width: max-content;
    transition: transform 5s cubic-bezier(0.1, 0.5, 0.2, 1);
  }
  .open-item {
    width: 100px; height: 100px;
    border-radius: 10px;
    background: var(--bg4);
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 32px;
  }
  .open-indicator {
    position: absolute;
    top: 0; bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 3px;
    background: var(--gold);
    z-index: 2;
    box-shadow: 0 0 12px var(--gold);
  }

  /* ===== CASE BATTLE ===== */
  .battle-arena {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: start;
    margin-bottom: 24px;
  }
  .battle-player {
    background: var(--bg3);
    border: 2px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    text-align: center;
  }
  .battle-player.winner { border-color: var(--gold); background: rgba(245,158,11,0.08); }
  .battle-player .player-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 16px;
  }
  .battle-player .player-name { font-weight: 700; font-size: 16px; }
  .battle-player .total-value {
    font-family: 'Rajdhani', sans-serif;
    font-size: 32px;
    font-weight: 700;
    color: var(--gold);
    margin-top: 12px;
  }
  .battle-items { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
  .battle-item {
    width: 64px; height: 64px;
    background: var(--bg4);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    border: 1px solid var(--border);
  }
  .battle-vs {
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Rajdhani', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--text3);
    padding-top: 40px;
  }

  /* ===== LOGIN MODAL ===== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(6px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .modal {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 48px;
    width: 100%;
    max-width: 440px;
    position: relative;
    animation: modalIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  @keyframes modalIn {
    from { transform: scale(0.85); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .modal-logo {
    font-family: 'Rajdhani', sans-serif;
    font-size: 32px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--accent), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 2px;
  }
  .modal-subtitle { text-align: center; color: var(--text2); font-size: 14px; margin-bottom: 36px; }
  .discord-btn {
    width: 100%;
    padding: 16px;
    background: #5865F2;
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    transition: all 0.2s;
    font-family: 'DM Sans', sans-serif;
    box-shadow: 0 4px 20px rgba(88,101,242,0.4);
    margin-bottom: 16px;
  }
  .discord-btn:hover { background: #4752c4; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(88,101,242,0.5); }
  .discord-icon {
    width: 24px; height: 24px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #5865F2;
    font-weight: 900;
    font-size: 12px;
  }
  .modal-divider {
    text-align: center;
    color: var(--text3);
    font-size: 12px;
    margin: 16px 0;
    position: relative;
  }
  .modal-divider::before, .modal-divider::after {
    content:'';
    position: absolute;
    top: 50%;
    width: 40%;
    height: 1px;
    background: var(--border);
  }
  .modal-divider::before { left: 0; }
  .modal-divider::after { right: 0; }
  .modal-note { text-align: center; color: var(--text3); font-size: 12px; line-height: 1.6; }
  .modal-close {
    position: absolute;
    top: 16px; right: 16px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    width: 32px; height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text2);
    font-size: 16px;
    transition: all 0.2s;
  }
  .modal-close:hover { background: var(--bg4); color: var(--text); }

  /* WIN ANIMATION */
  .confetti-container {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 999;
  }
  .confetti-piece {
    position: absolute;
    width: 10px; height: 10px;
    animation: confettiFall 2s ease-out forwards;
  }
  @keyframes confettiFall {
    0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
  }

  /* CHAT / LIVE FEED */
  .live-feed {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 280px;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
    z-index: 50;
  }
  .live-feed-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 600;
  }
  .live-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 6px var(--green);
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
  .live-feed-items {
    padding: 8px;
    max-height: 200px;
    overflow-y: auto;
  }
  .live-item {
    padding: 6px 8px;
    border-radius: 6px;
    font-size: 12px;
    color: var(--text2);
    border-bottom: 1px solid rgba(30,35,53,0.5);
    display: flex;
    align-items: center;
    gap: 6px;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .live-item .win { color: var(--green); font-weight: 700; }
  .live-item .lose { color: var(--red); font-weight: 700; }
  .live-item-icon { font-size: 14px; }

  /* STATS BAR */
  .stats-bar {
    display: flex;
    gap: 16px;
    margin-bottom: 28px;
  }
  .stat-card {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
  }
  .stat-card .stat-label { font-size: 11px; color: var(--text2); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 6px; }
  .stat-card .stat-value {
    font-family: 'Rajdhani', sans-serif;
    font-size: 24px;
    font-weight: 700;
    color: var(--gold);
  }
  .stat-card .stat-value.green { color: var(--green); }
  .stat-card .stat-value.red { color: var(--red); }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    .game-layout { grid-template-columns: 1fr; }
    .sidebar { transform: translateX(-220px); }
    .main, .topbar { margin-left: 0; left: 0; }
  }

  .separator {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
  }

  .section-title {
    font-family: 'Rajdhani', sans-serif;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 1px;
    margin-bottom: 16px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .tag-purple { background: rgba(108,99,255,0.15); color: var(--accent); border: 1px solid rgba(108,99,255,0.3); }
  .tag-green { background: rgba(16,185,129,0.15); color: var(--green); border: 1px solid rgba(16,185,129,0.3); }
  .tag-gold { background: rgba(245,158,11,0.15); color: var(--gold); border: 1px solid rgba(245,158,11,0.3); }
</style>
</head>
<body>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="loginModal">
  <div class="modal">
    <div class="modal-close" onclick="closeModal()">‚úï</div>
    <div class="modal-logo">STAKE.GG</div>
    <p class="modal-subtitle">The premium token casino experience</p>
    <button class="discord-btn" onclick="discordLogin()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057.101 18.08.114 18.102.134 18.115a19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
      Continue with Discord
    </button>
    <div class="modal-divider">OR</div>
    <button class="btn btn-outline" style="width:100%;padding:12px;font-size:14px;" onclick="guestLogin()">Play as Guest (Demo Mode)</button>
    <p class="modal-note" style="margin-top:20px;">By signing in you agree to our Terms of Service.<br>Only fake tokens are used ‚Äî no real money involved.</p>
  </div>
</div>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="logo">STAKE<span style="color:var(--gold)">.</span>GG</div>
  
  <div class="nav-section">Games</div>
  <div class="nav-item active" onclick="navigate('home')"><span class="icon">üè†</span>Home</div>
  <div class="nav-item" onclick="navigate('mines')"><span class="icon">üíé</span>Mines</div>
  <div class="nav-item" onclick="navigate('jackpot')"><span class="icon">üé°</span>Jackpot</div>
  <div class="nav-item" onclick="navigate('roulette')"><span class="icon">üé∞</span>Roulette</div>
  <div class="nav-item" onclick="navigate('dice')"><span class="icon">üé≤</span>Dice</div>
  <div class="nav-item" onclick="navigate('tower')"><span class="icon">üóº</span>Tower</div>
  <div class="nav-item" onclick="navigate('cases')"><span class="icon">üì¶</span>Cases</div>
  <div class="nav-item" onclick="navigate('battle')"><span class="icon">‚öîÔ∏è</span>Case Battle</div>
  
  <div class="nav-section">Account</div>
  <div class="nav-item" onclick="showProfile()"><span class="icon">üë§</span>Profile</div>
  <div class="nav-item" onclick="showHistory()"><span class="icon">üìã</span>History</div>

  <div class="sidebar-footer">
    <div style="font-size:11px;color:var(--text3);line-height:1.6;">
      üîí Provably fair<br>
      üí∞ Fake tokens only<br>
      <span style="color:var(--accent)">v1.0.0</span>
    </div>
  </div>
</nav>

<!-- TOPBAR -->
<div class="topbar">
  <div style="font-family:'Rajdhani';font-size:18px;font-weight:700;letter-spacing:1px;color:var(--text2)" id="pageTitle">HOME</div>
  <div style="display:flex;align-items:center;gap:12px;">
    <div class="balance-display">
      <span>ü™ô</span>
      <div>
        <div class="label">Balance</div>
        <span id="balanceDisplay">1,000</span>
      </div>
    </div>
    <button class="btn btn-gold btn-sm" onclick="addFreeTokens()">+ Free Tokens</button>
    <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">üòé</div>
  </div>
</div>

<!-- MAIN CONTENT -->
<main class="main">

  <!-- HOME PAGE -->
  <div class="page active" id="page-home">
    <div class="hero">
      <h1>Win Big with<br><span class="highlight">Fake Tokens</span></h1>
      <p>Experience the thrill of casino gaming with zero real money risk. Play all your favorite games with our virtual token system.</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="navigate('mines')">üéÆ Play Now</button>
        <button class="btn btn-outline" onclick="addFreeTokens()">ü™ô Free Tokens</button>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-label">Your Balance</div>
        <div class="stat-value" id="homeBalance">1,000</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Won</div>
        <div class="stat-value green" id="totalWon">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Wagered</div>
        <div class="stat-value" id="totalWagered">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Biggest Win</div>
        <div class="stat-value green" id="biggestWin">0</div>
      </div>
    </div>

    <div class="section-title">üéÆ All Games</div>
    <div class="games-grid">
      <div class="game-card" onclick="navigate('mines')">
        <span class="game-icon">üíé</span>
        <div class="badge badge-hot">HOT</div>
        <div class="game-name">MINES</div>
        <div class="game-desc">Reveal gems, avoid bombs</div>
      </div>
      <div class="game-card" onclick="navigate('jackpot')">
        <span class="game-icon">üé°</span>
        <div class="badge">LIVE</div>
        <div class="game-name">JACKPOT</div>
        <div class="game-desc">Spin the wheel of fortune</div>
      </div>
      <div class="game-card" onclick="navigate('roulette')">
        <span class="game-icon">üé∞</span>
        <div class="game-name">ROULETTE</div>
        <div class="game-desc">Red, black or green</div>
      </div>
      <div class="game-card" onclick="navigate('dice')">
        <span class="game-icon">üé≤</span>
        <div class="game-name">DICE</div>
        <div class="game-desc">Roll high or roll low</div>
      </div>
      <div class="game-card" onclick="navigate('tower')">
        <span class="game-icon">üóº</span>
        <div class="badge badge-new">NEW</div>
        <div class="game-name">TOWER</div>
        <div class="game-desc">Climb the multiplier tower</div>
      </div>
      <div class="game-card" onclick="navigate('cases')">
        <span class="game-icon">üì¶</span>
        <div class="game-name">CASES</div>
        <div class="game-desc">Open cases for prizes</div>
      </div>
      <div class="game-card" onclick="navigate('battle')">
        <span class="game-icon">‚öîÔ∏è</span>
        <div class="game-name">CASE BATTLE</div>
        <div class="game-desc">Battle the house</div>
      </div>
    </div>
  </div>

  <!-- MINES PAGE -->
  <div class="page" id="page-mines">
    <div class="game-title">üíé Mines</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Bet Amount</label>
          <input class="input-field" type="number" id="minesBet" value="100" min="1">
          <div class="bet-btns">
            <div class="bet-btn" onclick="multBet('minesBet',0.5)">¬Ω</div>
            <div class="bet-btn" onclick="multBet('minesBet',2)">2√ó</div>
            <div class="bet-btn" onclick="setBetMax('minesBet')">MAX</div>
          </div>
        </div>
        <div class="input-group">
          <label>Number of Mines</label>
          <select class="input-field" id="minesCount">
            <option value="1">1 Mine</option>
            <option value="3" selected>3 Mines</option>
            <option value="5">5 Mines</option>
            <option value="8">8 Mines</option>
            <option value="12">12 Mines</option>
            <option value="20">20 Mines</option>
          </select>
        </div>
        <div class="separator"></div>
        <div id="minesMultInfo" style="text-align:center;margin-bottom:16px;display:none;">
          <div class="mines-multiplier" id="minesMultDisplay">1.00√ó</div>
          <div class="mines-profit" id="minesProfitDisplay">+0 tokens</div>
        </div>
        <button class="btn btn-primary" style="width:100%;margin-bottom:8px;" id="minesStartBtn" onclick="startMines()">Start Game</button>
        <button class="btn btn-green" style="width:100%;display:none;" id="minesCashoutBtn" onclick="cashoutMines()">Cash Out</button>
      </div>
      <div class="game-area" id="minesArea">
        <div style="text-align:center;color:var(--text2);margin-bottom:20px;font-size:14px;">Click tiles to reveal gems. Hit a mine and you lose!</div>
        <div class="mines-grid" id="minesGrid"></div>
      </div>
    </div>
  </div>

  <!-- JACKPOT PAGE -->
  <div class="page" id="page-jackpot">
    <div class="game-title">üé° Jackpot</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Your Entry</label>
          <input class="input-field" type="number" id="jackpotBet" value="100" min="10">
          <div class="bet-btns">
            <div class="bet-btn" onclick="multBet('jackpotBet',0.5)">¬Ω</div>
            <div class="bet-btn" onclick="multBet('jackpotBet',2)">2√ó</div>
            <div class="bet-btn" onclick="setBetMax('jackpotBet')">MAX</div>
          </div>
        </div>
        <div class="separator"></div>
        <div class="jackpot-total">
          <span class="label">Total Pot</span>
          <span class="amount" id="jackpotTotal">0</span>
          <span class="label">tokens</span>
        </div>
        <div class="jackpot-status" id="jackpotStatus">Waiting for players...</div>
        <button class="btn btn-primary" style="width:100%;margin-bottom:8px;" id="jackpotEnterBtn" onclick="enterJackpot()">Enter Jackpot</button>
        <button class="btn btn-gold" style="width:100%;display:none;" id="jackpotSpinBtn" onclick="spinJackpot()">üé° Spin!</button>
        <div class="separator"></div>
        <div class="section-title" style="font-size:16px;">Players</div>
        <div class="jackpot-players" id="jackpotPlayers">
          <div style="text-align:center;color:var(--text3);font-size:13px;padding:16px;">No players yet</div>
        </div>
        <button class="btn btn-outline btn-sm" style="width:100%;margin-top:8px;" onclick="addBotToJackpot()">+ Add Bot Player</button>
      </div>
      <div class="game-area">
        <div class="jackpot-container">
          <div class="wheel-wrapper">
            <div class="wheel-tick"></div>
            <canvas id="jackpotCanvas" width="380" height="380"></canvas>
            <div class="wheel-pointer">üéØ</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ROULETTE PAGE -->
  <div class="page" id="page-roulette">
    <div class="game-title">üé∞ Roulette</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Bet Amount</label>
          <input class="input-field" type="number" id="rouletteBet" value="100" min="1">
          <div class="bet-btns">
            <div class="bet-btn" onclick="multBet('rouletteBet',0.5)">¬Ω</div>
            <div class="bet-btn" onclick="multBet('rouletteBet',2)">2√ó</div>
            <div class="bet-btn" onclick="setBetMax('rouletteBet')">MAX</div>
          </div>
        </div>
        <div class="separator"></div>
        <div class="section-title" style="font-size:16px;">Choose Color</div>
        <div class="roulette-bets">
          <div class="roulette-bet-btn bet-red" id="betRed" onclick="selectRouletteBet('red')">
            üî¥ RED
            <span class="mult">2√ó payout</span>
          </div>
          <div class="roulette-bet-btn bet-green" id="betGreen" onclick="selectRouletteBet('green')">
            üü¢ GREEN
            <span class="mult">14√ó payout</span>
          </div>
          <div class="roulette-bet-btn bet-black" id="betBlack" onclick="selectRouletteBet('black')">
            ‚ö´ BLACK
            <span class="mult">2√ó payout</span>
          </div>
        </div>
        <div class="separator"></div>
        <div id="rouletteSelectedBet" style="color:var(--text2);font-size:13px;text-align:center;margin-bottom:12px;">No bet selected</div>
        <button class="btn btn-primary" style="width:100%;" onclick="spinRoulette()">Spin!</button>
      </div>
      <div class="game-area" style="justify-content:flex-start;padding-top:32px;">
        <div style="width:100%;">
          <div style="text-align:center;margin-bottom:20px;">
            <div id="rouletteResult" style="font-family:'Rajdhani';font-size:20px;color:var(--text2);">Place your bet and spin!</div>
          </div>
          <div class="roulette-track-wrapper">
            <div class="roulette-indicator"></div>
            <div class="roulette-track" id="rouletteTrack"></div>
          </div>
          <div style="display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-top:12px;" id="rouletteHistory"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- DICE PAGE -->
  <div class="page" id="page-dice">
    <div class="game-title">üé≤ Dice</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Bet Amount</label>
          <input class="input-field" type="number" id="diceBet" value="100" min="1">
          <div class="bet-btns">
            <div class="bet-btn" onclick="multBet('diceBet',0.5)">¬Ω</div>
            <div class="bet-btn" onclick="multBet('diceBet',2)">2√ó</div>
            <div class="bet-btn" onclick="setBetMax('diceBet')">MAX</div>
          </div>
        </div>
        <div class="input-group">
          <label>Win Condition</label>
          <select class="input-field" id="diceMode" onchange="updateDiceSlider()">
            <option value="under">Roll Under</option>
            <option value="over">Roll Over</option>
          </select>
        </div>
        <div class="separator"></div>
        <div style="background:var(--bg3);border-radius:10px;padding:14px;margin-bottom:16px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
            <div><div style="font-size:11px;color:var(--text2)">WIN CHANCE</div><div class="dice-info"><span class="val" id="diceChance">49.5%</span></div></div>
            <div style="text-align:right"><div style="font-size:11px;color:var(--text2)">MULTIPLIER</div><div class="dice-info"><span class="val" id="diceMult">2.00√ó</span></div></div>
          </div>
        </div>
        <div class="dice-slider-wrap">
          <input type="range" class="dice-range" id="diceSlider" min="2" max="98" value="50" oninput="updateDiceSlider()">
          <div class="dice-info">
            <span>Roll: <span id="diceTarget" style="color:var(--text)">50</span></span>
          </div>
        </div>
        <button class="btn btn-primary" style="width:100%;margin-top:12px;" onclick="rollDice()" id="diceRollBtn">Roll Dice</button>
      </div>
      <div class="game-area">
        <div class="dice-display">
          <div class="dice-face" id="diceDisplay" style="width:160px;height:160px;font-size:80px;">üé≤</div>
        </div>
        <div style="font-family:'Rajdhani';font-size:20px;color:var(--text2);margin-bottom:8px;" id="diceResultText">Roll to win!</div>
        <div id="diceResultBadge"></div>
        <div style="margin-top:24px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center;" id="diceHistory"></div>
      </div>
    </div>
  </div>

  <!-- TOWER PAGE -->
  <div class="page" id="page-tower">
    <div class="game-title">üóº Tower</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Bet Amount</label>
          <input class="input-field" type="number" id="towerBet" value="100" min="1">
          <div class="bet-btns">
            <div class="bet-btn" onclick="multBet('towerBet',0.5)">¬Ω</div>
            <div class="bet-btn" onclick="multBet('towerBet',2)">2√ó</div>
            <div class="bet-btn" onclick="setBetMax('towerBet')">MAX</div>
          </div>
        </div>
        <div class="input-group">
          <label>Difficulty</label>
          <select class="input-field" id="towerDiff">
            <option value="easy">Easy (3 tiles, 1 bomb)</option>
            <option value="medium" selected>Medium (3 tiles, 2 bombs)</option>
            <option value="hard">Hard (2 tiles, 1 bomb)</option>
            <option value="expert">Expert (2 tiles, 1.5 bombs)</option>
          </select>
        </div>
        <div class="separator"></div>
        <div id="towerMultDisplay" style="text-align:center;margin-bottom:16px;display:none;">
          <div class="tower-mult" id="towerMultValue">1.00√ó</div>
          <div style="color:var(--green);font-size:14px;font-weight:600;" id="towerProfitValue">+0 tokens</div>
        </div>
        <button class="btn btn-primary" style="width:100%;margin-bottom:8px;" id="towerStartBtn" onclick="startTower()">Start Game</button>
        <button class="btn btn-green" style="width:100%;display:none;" id="towerCashoutBtn" onclick="cashoutTower()">Cash Out</button>
      </div>
      <div class="game-area" style="padding:32px;">
        <div class="tower-grid" id="towerGrid"></div>
      </div>
    </div>
  </div>

  <!-- CASES PAGE -->
  <div class="page" id="page-cases">
    <div class="game-title">üì¶ Cases</div>
    <div id="caseSelectView">
      <div class="section-title" style="font-size:16px;margin-bottom:16px;">Choose a Case</div>
      <div class="case-grid" id="caseGrid"></div>
    </div>
    <div id="caseOpenView" style="display:none;">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:24px;">
        <button class="btn btn-outline btn-sm" onclick="backToCases()">‚Üê Back</button>
        <div id="caseOpenTitle" class="section-title" style="margin-bottom:0;"></div>
      </div>
      <div style="display:flex;gap:20px;">
        <div style="flex:1;">
          <div class="open-animation-wrapper" id="openAnimWrapper" style="display:none;">
            <div class="open-indicator"></div>
            <div class="open-track" id="openTrack"></div>
          </div>
          <div id="openResult" style="display:none;text-align:center;padding:24px;"></div>
          <div style="background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:20px;">
            <div style="font-size:13px;font-weight:600;color:var(--text2);margin-bottom:12px;text-transform:uppercase;letter-spacing:1px;">Case Contents</div>
            <div id="caseContents" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
          </div>
        </div>
        <div style="width:240px;">
          <div class="card">
            <div class="input-group">
              <label>Case Price</label>
              <div style="font-family:'Rajdhani';font-size:24px;font-weight:700;color:var(--gold);" id="casePriceDisplay">0</div>
            </div>
            <div class="separator"></div>
            <button class="btn btn-primary" style="width:100%;margin-bottom:8px;" onclick="openCase()" id="openCaseBtn">Open Case</button>
            <button class="btn btn-outline" style="width:100%;font-size:12px;" onclick="openCase(true)">Open 5 Cases</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CASE BATTLE PAGE -->
  <div class="page" id="page-battle">
    <div class="game-title">‚öîÔ∏è Case Battle</div>
    <div class="game-layout">
      <div class="game-controls">
        <div class="input-group">
          <label>Select Case</label>
          <select class="input-field" id="battleCaseSelect">
            <option value="0">Basic Case (100 tokens)</option>
            <option value="1">Rare Case (500 tokens)</option>
            <option value="2">Epic Case (1000 tokens)</option>
            <option value="3">Legendary Case (2500 tokens)</option>
          </select>
        </div>
        <div class="input-group">
          <label>Number of Cases</label>
          <select class="input-field" id="battleCaseCount">
            <option value="1">1 Case</option>
            <option value="3" selected>3 Cases</option>
            <option value="5">5 Cases</option>
          </select>
        </div>
        <div class="separator"></div>
        <div style="background:var(--bg3);border-radius:8px;padding:12px;margin-bottom:16px;font-size:13px;">
          <div style="display:flex;justify-content:space-between;color:var(--text2);margin-bottom:4px;">
            <span>Cost per player</span>
            <span style="color:var(--gold);font-family:'Rajdhani';font-weight:700;" id="battleCost">300</span>
          </div>
        </div>
        <button class="btn btn-primary" style="width:100%" onclick="startBattle()">Start Battle</button>
      </div>
      <div class="game-area" style="justify-content:flex-start;padding-top:20px;">
        <div style="width:100%;">
          <div class="battle-arena" id="battleArena">
            <div class="battle-player" id="battlePlayer1">
              <div class="player-info">
                <div class="user-avatar" style="width:40px;height:40px;">üòé</div>
                <div class="player-name">You</div>
              </div>
              <div class="battle-items" id="battleItems1"></div>
              <div class="total-value" id="battleTotal1">0 ü™ô</div>
            </div>
            <div class="battle-vs">VS</div>
            <div class="battle-player" id="battlePlayer2">
              <div class="player-info">
                <div class="user-avatar" style="width:40px;height:40px;background:linear-gradient(135deg,#ef4444,#dc2626);">ü§ñ</div>
                <div class="player-name">Bot</div>
              </div>
              <div class="battle-items" id="battleItems2"></div>
              <div class="total-value" id="battleTotal2">0 ü™ô</div>
            </div>
          </div>
          <div id="battleResult" style="text-align:center;"></div>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- LIVE FEED -->
<div class="live-feed">
  <div class="live-feed-header">
    <div class="live-dot"></div>
    Live Activity
  </div>
  <div class="live-feed-items" id="liveFeed"></div>
</div>

<script>
// ============ STATE ============
let state = {
  balance: 1000,
  user: null,
  totalWon: 0,
  totalWagered: 0,
  biggestWin: 0,
  betHistory: []
};

// ============ UTILS ============
function fmt(n) { return Math.floor(n).toLocaleString(); }
function rnd(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

function updateBalance() {
  document.getElementById('balanceDisplay').textContent = fmt(state.balance);
  document.getElementById('homeBalance').textContent = fmt(state.balance);
  document.getElementById('totalWon').textContent = fmt(state.totalWon);
  document.getElementById('totalWagered').textContent = fmt(state.totalWagered);
  document.getElementById('biggestWin').textContent = fmt(state.biggestWin);
}

function placeBet(amount) {
  amount = parseInt(amount);
  if (isNaN(amount) || amount < 1) { toast('Invalid bet amount', 'red'); return false; }
  if (amount > state.balance) { toast('Insufficient balance!', 'red'); return false; }
  state.balance -= amount;
  state.totalWagered += amount;
  updateBalance();
  return true;
}

function winBet(amount) {
  state.balance += amount;
  state.totalWon += amount;
  if (amount > state.biggestWin) state.biggestWin = amount;
  updateBalance();
}

function toast(msg, type = 'green') {
  const t = document.createElement('div');
  t.style.cssText = `position:fixed;top:80px;right:20px;z-index:2000;padding:12px 20px;border-radius:10px;font-size:14px;font-weight:600;animation:popIn 0.3s ease;`;
  t.style.background = type === 'green' ? '#065f46' : '#7f1d1d';
  t.style.border = `1px solid ${type === 'green' ? '#059669' : '#dc2626'}`;
  t.style.color = type === 'green' ? '#10b981' : '#ef4444';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2500);
}

function multBet(id, mult) {
  const el = document.getElementById(id);
  el.value = Math.max(1, Math.floor(parseFloat(el.value) * mult));
}
function setBetMax(id) {
  document.getElementById(id).value = state.balance;
}

function addFreeTokens() {
  state.balance += 500;
  updateBalance();
  toast('+500 Free Tokens Added! ü™ô');
  addLiveFeed('System', 'claimed 500 free tokens', 'üéÅ', true);
}

function addLiveFeed(user, action, icon, win) {
  const feed = document.getElementById('liveFeed');
  const el = document.createElement('div');
  el.className = 'live-item';
  el.innerHTML = `<span class="live-item-icon">${icon}</span><span style="flex:1"><b>${user}</b> ${action}</span>`;
  feed.insertBefore(el, feed.firstChild);
  while (feed.children.length > 8) feed.removeChild(feed.lastChild);
}

function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('pageTitle').textContent = page.toUpperCase();
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.textContent.trim().toLowerCase().includes(page.toLowerCase().split('-')[0])) n.classList.add('active');
  });
  if (page === 'roulette') initRouletteTrack();
  if (page === 'jackpot') drawJackpotWheel();
  if (page === 'mines') initMinesGrid();
  if (page === 'tower') initTowerGrid();
  if (page === 'cases') initCases();
  if (page === 'battle') updateBattleCost();
}

function confetti() {
  const colors = ['#6c63ff','#f59e0b','#10b981','#ef4444','#8b5cf6','#fbbf24'];
  const container = document.createElement('div');
  container.className = 'confetti-container';
  document.body.appendChild(container);
  for (let i = 0; i < 80; i++) {
    const p = document.createElement('div');
    p.className = 'confetti-piece';
    p.style.cssText = `left:${Math.random()*100}%;top:-10px;background:${colors[rnd(0,colors.length-1)]};width:${rnd(6,12)}px;height:${rnd(6,12)}px;border-radius:${Math.random()>0.5?'50%':'2px'};animation-delay:${Math.random()*0.5}s;animation-duration:${1.5+Math.random()*1}s;`;
    container.appendChild(p);
  }
  setTimeout(() => container.remove(), 3000);
}

// ============ AUTH ============
function discordLogin() {
  // Simulated Discord OAuth - in production redirect to /auth/discord
  document.getElementById('loginModal').style.display = 'none';
  state.user = { name: 'Player', avatar: null, discriminator: '0000' };
  document.getElementById('userAvatar').textContent = 'üòé';
  toast('Logged in as Player!');
  addLiveFeed('Player', 'joined the casino', 'üéÆ', true);
}

function guestLogin() {
  document.getElementById('loginModal').style.display = 'none';
  state.user = { name: 'Guest', avatar: null, guest: true };
  toast('Playing as guest. Progress won\'t save.', 'red');
}

function closeModal() {
  document.getElementById('loginModal').style.display = 'none';
}

function showProfile() {
  toast('Profile: Guest Player | Balance: ' + fmt(state.balance) + ' tokens');
}
function showHistory() {
  toast('History feature coming with backend!');
}
function toggleUserMenu() {
  if (!state.user) { document.getElementById('loginModal').style.display = 'flex'; }
  else { toast('Logged in as ' + state.user.name); }
}

// ============ MINES ============
let minesState = { active: false, grid: [], bombs: [], revealed: 0, bet: 0 };

function initMinesGrid() {
  const grid = document.getElementById('minesGrid');
  grid.innerHTML = '';
  for (let i = 0; i < 25; i++) {
    const cell = document.createElement('div');
    cell.className = 'mine-cell';
    cell.innerHTML = '‚ùì';
    cell.onclick = () => clickMine(i);
    cell.id = 'mc-' + i;
    grid.appendChild(cell);
  }
}

function getMinesMultiplier(revealed, mines) {
  // House edge multiplier calculation
  const safe = 25 - mines;
  let mult = 1;
  for (let i = 0; i < revealed; i++) {
    mult *= (25 - mines - i) / (25 - i);
  }
  return Math.max(1, (0.97 / mult));
}

function startMines() {
  const bet = parseInt(document.getElementById('minesBet').value);
  if (!placeBet(bet)) return;
  const mines = parseInt(document.getElementById('minesCount').value);
  
  minesState.active = true;
  minesState.bet = bet;
  minesState.revealed = 0;
  minesState.grid = Array(25).fill(null);
  minesState.bombs = [];
  
  // Place bombs
  while (minesState.bombs.length < mines) {
    const pos = rnd(0, 24);
    if (!minesState.bombs.includes(pos)) minesState.bombs.push(pos);
  }

  // Reset grid
  for (let i = 0; i < 25; i++) {
    const cell = document.getElementById('mc-' + i);
    cell.className = 'mine-cell';
    cell.innerHTML = '‚ùì';
    cell.style.pointerEvents = 'auto';
  }
  
  document.getElementById('minesStartBtn').textContent = 'Restart';
  document.getElementById('minesCashoutBtn').style.display = 'block';
  document.getElementById('minesMultInfo').style.display = 'block';
  updateMinesDisplay();
}

function clickMine(i) {
  if (!minesState.active || minesState.grid[i] !== null) return;
  
  if (minesState.bombs.includes(i)) {
    // BOOM
    minesState.grid[i] = 'bomb';
    const cell = document.getElementById('mc-' + i);
    cell.className = 'mine-cell revealed-bomb';
    cell.innerHTML = 'üí£';
    minesState.active = false;
    
    // Reveal all bombs
    setTimeout(() => {
      minesState.bombs.forEach(b => {
        const bc = document.getElementById('mc-' + b);
        bc.className = 'mine-cell revealed-bomb auto-reveal';
        bc.innerHTML = 'üí£';
      });
    }, 300);
    
    document.getElementById('minesCashoutBtn').style.display = 'none';
    document.getElementById('minesStartBtn').textContent = 'Play Again';
    toast('üí• BOOM! You hit a mine!', 'red');
    addLiveFeed('You', 'hit a mine and lost ' + fmt(minesState.bet) + ' tokens', 'üí£', false);
  } else {
    minesState.grid[i] = 'gem';
    minesState.revealed++;
    const cell = document.getElementById('mc-' + i);
    cell.className = 'mine-cell revealed-gem';
    cell.innerHTML = 'üíé';
    updateMinesDisplay();
    
    if (minesState.revealed === 25 - minesState.bombs.length) {
      cashoutMines();
    }
  }
}

function updateMinesDisplay() {
  const mult = getMinesMultiplier(minesState.revealed, minesState.bombs.length);
  const profit = Math.floor(minesState.bet * mult) - minesState.bet;
  document.getElementById('minesMultDisplay').textContent = mult.toFixed(2) + '√ó';
  document.getElementById('minesProfitDisplay').textContent = '+' + fmt(minesState.bet * mult) + ' tokens';
}

function cashoutMines() {
  if (!minesState.active) return;
  minesState.active = false;
  const mult = getMinesMultiplier(minesState.revealed, minesState.bombs.length);
  const win = Math.floor(minesState.bet * mult);
  winBet(win);
  document.getElementById('minesCashoutBtn').style.display = 'none';
  document.getElementById('minesStartBtn').textContent = 'Play Again';
  toast('üíé Cashed out ' + fmt(win) + ' tokens!');
  if (mult > 2) confetti();
  addLiveFeed('You', 'cashed out ' + fmt(win) + ' tokens in Mines', 'üíé', true);
}

// ============ JACKPOT ============
let jackpotState = { players: [], totalPot: 0, spinning: false };
const PLAYER_COLORS = ['#6c63ff','#f59e0b','#10b981','#ef4444','#8b5cf6','#06b6d4','#ec4899','#f97316'];
const BOT_NAMES = ['xSlayer99','CryptoKing','LuckyDragon','NightHawk','SilverFox','ThunderBolt'];

function drawJackpotWheel() {
  const canvas = document.getElementById('jackpotCanvas');
  const ctx = canvas.getContext('2d');
  const cx = 190, cy = 190, r = 185;
  ctx.clearRect(0,0,380,380);
  
  if (jackpotState.players.length === 0) {
    ctx.beginPath();
    ctx.arc(cx,cy,r,0,Math.PI*2);
    ctx.fillStyle = '#1e2235';
    ctx.fill();
    ctx.strokeStyle = '#2a3050';
    ctx.lineWidth = 3;
    ctx.stroke();
    ctx.fillStyle = '#4a5568';
    ctx.font = 'bold 16px Rajdhani';
    ctx.textAlign = 'center';
    ctx.fillText('Enter to join!', cx, cy);
    return;
  }
  
  const total = jackpotState.totalPot;
  let angle = -Math.PI/2;
  
  jackpotState.players.forEach((p, idx) => {
    const slice = (p.tokens / total) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, angle, angle + slice);
    ctx.closePath();
    ctx.fillStyle = p.color;
    ctx.fill();
    ctx.strokeStyle = '#0a0b0f';
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // Label
    const midAngle = angle + slice/2;
    if (slice > 0.3) {
      ctx.save();
      ctx.translate(cx + (r*0.65)*Math.cos(midAngle), cy + (r*0.65)*Math.sin(midAngle));
      ctx.fillStyle = 'white';
      ctx.font = 'bold 13px DM Sans';
      ctx.textAlign = 'center';
      ctx.fillText(p.name.slice(0,8), 0, 0);
      ctx.font = '11px DM Sans';
      ctx.fillText(fmt(p.tokens) + ' ü™ô', 0, 16);
      ctx.restore();
    }
    angle += slice;
  });
  
  // Center circle
  ctx.beginPath();
  ctx.arc(cx,cy,30,0,Math.PI*2);
  ctx.fillStyle = '#0a0b0f';
  ctx.fill();
  ctx.strokeStyle = '#1e2235';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  updateJackpotUI();
}

function updateJackpotUI() {
  document.getElementById('jackpotTotal').textContent = fmt(jackpotState.totalPot);
  
  const playersDiv = document.getElementById('jackpotPlayers');
  if (jackpotState.players.length === 0) {
    playersDiv.innerHTML = '<div style="text-align:center;color:var(--text3);font-size:13px;padding:16px;">No players yet</div>';
    return;
  }
  
  playersDiv.innerHTML = jackpotState.players.map(p => `
    <div class="jackpot-player">
      <div class="player-color-dot" style="background:${p.color}"></div>
      <div style="flex:1">
        <div style="font-weight:600;font-size:14px;">${p.name}</div>
        <div style="color:var(--text2);font-size:12px;">${fmt(p.tokens)} tokens</div>
      </div>
      <div class="player-chance">${((p.tokens/jackpotState.totalPot)*100).toFixed(1)}%</div>
    </div>
  `).join('');
  
  const status = jackpotState.players.length;
  document.getElementById('jackpotStatus').textContent = 
    status >= 2 ? `${status} players ‚Äî Ready to spin!` : '1 player ‚Äî Need more to spin...';
  document.getElementById('jackpotSpinBtn').style.display = status >= 2 ? 'block' : 'none';
}

function enterJackpot() {
  if (jackpotState.spinning) return;
  const bet = parseInt(document.getElementById('jackpotBet').value);
  if (!placeBet(bet)) return;
  
  const colorIdx = jackpotState.players.length % PLAYER_COLORS.length;
  jackpotState.players.push({
    name: state.user ? state.user.name : 'You',
    tokens: bet,
    color: PLAYER_COLORS[colorIdx],
    isYou: true
  });
  jackpotState.totalPot += bet;
  
  document.getElementById('jackpotEnterBtn').style.display = 'none';
  document.getElementById('jackpotStatus').textContent = 'Entered! Waiting for others...';
  drawJackpotWheel();
  toast('Entered jackpot with ' + fmt(bet) + ' tokens!');
  addLiveFeed('You', 'entered jackpot with ' + fmt(bet) + ' tokens', 'üé°', null);
}

function addBotToJackpot() {
  if (jackpotState.spinning) return;
  const bet = rnd(50, 500) * 10;
  const name = BOT_NAMES[rnd(0, BOT_NAMES.length-1)];
  const colorIdx = jackpotState.players.length % PLAYER_COLORS.length;
  jackpotState.players.push({ name, tokens: bet, color: PLAYER_COLORS[colorIdx], isYou: false });
  jackpotState.totalPot += bet;
  drawJackpotWheel();
  addLiveFeed(name, 'entered jackpot with ' + fmt(bet) + ' tokens', 'ü§ñ', null);
}

function spinJackpot() {
  if (jackpotState.spinning || jackpotState.players.length < 2) return;
  jackpotState.spinning = true;
  document.getElementById('jackpotSpinBtn').style.display = 'none';
  document.getElementById('jackpotEnterBtn').style.display = 'none';
  
  // Pick winner weighted by tokens
  const rand = Math.random() * jackpotState.totalPot;
  let cumulative = 0;
  let winner = jackpotState.players[jackpotState.players.length-1];
  for (const p of jackpotState.players) {
    cumulative += p.tokens;
    if (rand <= cumulative) { winner = p; break; }
  }
  
  // Animate spin
  const canvas = document.getElementById('jackpotCanvas');
  const ctx = canvas.getContext('2d');
  let spinAngle = 0;
  const targetSpins = 5 + Math.random() * 3;
  const totalAngle = targetSpins * Math.PI * 2;
  
  // Calculate final angle so winner segment is at top
  const winnerStart = jackpotState.players.reduce((acc, p, i) => {
    if (jackpotState.players.indexOf(winner) > i) return acc + (p.tokens/jackpotState.totalPot)*Math.PI*2;
    return acc;
  }, 0);
  const finalAngle = totalAngle - winnerStart - (winner.tokens/jackpotState.totalPot)*Math.PI;
  
  let startTime = null;
  function animate(ts) {
    if (!startTime) startTime = ts;
    const progress = Math.min((ts - startTime) / 4000, 1);
    const ease = 1 - Math.pow(1 - progress, 4);
    const currentAngle = ease * finalAngle;
    
    // Redraw rotated
    ctx.clearRect(0,0,380,380);
    const cx=190,cy=190,r=185;
    let baseAngle = -Math.PI/2 + currentAngle;
    jackpotState.players.forEach(p => {
      const slice = (p.tokens/jackpotState.totalPot)*Math.PI*2;
      ctx.beginPath();
      ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,r,baseAngle,baseAngle+slice);
      ctx.closePath();
      ctx.fillStyle = p.color;
      ctx.fill();
      ctx.strokeStyle='#0a0b0f';ctx.lineWidth=2;ctx.stroke();
      const midAngle = baseAngle+slice/2;
      if (slice>0.3) {
        ctx.save();
        ctx.translate(cx+(r*0.65)*Math.cos(midAngle),cy+(r*0.65)*Math.sin(midAngle));
        ctx.fillStyle='white';ctx.font='bold 13px DM Sans';ctx.textAlign='center';
        ctx.fillText(p.name.slice(0,8),0,0);
        ctx.restore();
      }
      baseAngle+=slice;
    });
    ctx.beginPath();ctx.arc(cx,cy,30,0,Math.PI*2);ctx.fillStyle='#0a0b0f';ctx.fill();
    
    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      // Show winner
      setTimeout(() => {
        if (winner.isYou) {
          winBet(jackpotState.totalPot);
          toast('üéâ YOU WON ' + fmt(jackpotState.totalPot) + ' tokens!');
          confetti();
          addLiveFeed('You', 'won the jackpot! +' + fmt(jackpotState.totalPot) + ' tokens', 'üéâ', true);
        } else {
          toast('üò¢ ' + winner.name + ' won the jackpot!', 'red');
          addLiveFeed(winner.name, 'won the jackpot! +' + fmt(jackpotState.totalPot) + ' tokens', 'üé°', true);
        }
        jackpotState = { players: [], totalPot: 0, spinning: false };
        document.getElementById('jackpotEnterBtn').style.display = 'block';
        setTimeout(() => drawJackpotWheel(), 100);
      }, 500);
    }
  }
  requestAnimationFrame(animate);
}

// ============ ROULETTE ============
const ROULETTE_SEQUENCE = [
  {n:0,c:'green'},{n:1,c:'red'},{n:14,c:'black'},{n:2,c:'red'},{n:13,c:'black'},
  {n:3,c:'red'},{n:12,c:'black'},{n:4,c:'red'},{n:11,c:'black'},{n:5,c:'red'},
  {n:10,c:'black'},{n:6,c:'red'},{n:9,c:'black'},{n:7,c:'red'},{n:8,c:'black'},
  {n:0,c:'green'},{n:8,c:'black'},{n:7,c:'red'},{n:9,c:'black'},{n:6,c:'red'},
  {n:10,c:'black'},{n:5,c:'red'},{n:11,c:'black'},{n:4,c:'red'},{n:12,c:'black'},
  {n:3,c:'red'},{n:13,c:'black'},{n:2,c:'red'},{n:14,c:'black'},{n:1,c:'red'}
];

let rouletteState = { selectedBet: null, spinning: false, history: [] };

function initRouletteTrack() {
  const track = document.getElementById('rouletteTrack');
  track.style.transition = 'none';
  track.style.transform = 'translateX(0)';
  let items = '';
  for (let i = 0; i < 100; i++) {
    const item = ROULETTE_SEQUENCE[i % ROULETTE_SEQUENCE.length];
    items += `<div class="roulette-item ${item.c}">${item.n}</div>`;
  }
  track.innerHTML = items;
}

function selectRouletteBet(color) {
  rouletteState.selectedBet = color;
  document.querySelectorAll('.roulette-bet-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('bet' + color.charAt(0).toUpperCase() + color.slice(1)).classList.add('selected');
  const mults = {red:'2√ó',black:'2√ó',green:'14√ó'};
  document.getElementById('rouletteSelectedBet').textContent = `Betting on ${color.toUpperCase()} (${mults[color]} payout)`;
  document.getElementById('rouletteSelectedBet').style.color = color === 'red' ? 'var(--red)' : color === 'green' ? 'var(--green)' : 'var(--text)';
}

function spinRoulette() {
  if (rouletteState.spinning) return;
  if (!rouletteState.selectedBet) { toast('Select a color first!', 'red'); return; }
  const bet = parseInt(document.getElementById('rouletteBet').value);
  if (!placeBet(bet)) return;
  
  rouletteState.spinning = true;
  
  // Determine result
  const rand = Math.random();
  let result;
  if (rand < 1/15) result = {n:0,c:'green'};
  else if (rand < 8/15) result = {n:rnd(1,7),c:'red'};
  else result = {n:rnd(8,14),c:'black'};
  
  // Build track with result at center
  const track = document.getElementById('rouletteTrack');
  track.style.transition = 'none';
  track.style.transform = 'translateX(0)';
  
  let items = '';
  const totalItems = 80;
  const landingIdx = 60;
  
  for (let i = 0; i < totalItems; i++) {
    let item;
    if (i === landingIdx) item = result;
    else item = ROULETTE_SEQUENCE[(i*3) % ROULETTE_SEQUENCE.length];
    items += `<div class="roulette-item ${item.c}">${item.n}</div>`;
  }
  track.innerHTML = items;
  
  setTimeout(() => {
    const itemWidth = 86; // 80px + 6px gap
    const containerWidth = track.parentElement.offsetWidth;
    const targetX = -(landingIdx * itemWidth - containerWidth/2 + 40);
    track.style.transition = 'transform 6s cubic-bezier(0.15, 0.5, 0.2, 1)';
    track.style.transform = `translateX(${targetX}px)`;
  }, 50);
  
  setTimeout(() => {
    rouletteState.spinning = false;
    rouletteState.history.unshift(result);
    if (rouletteState.history.length > 10) rouletteState.history.pop();
    
    const won = rouletteState.selectedBet === result.c;
    const mult = result.c === 'green' ? 14 : 2;
    const winAmt = won ? bet * mult : 0;
    
    if (won) {
      winBet(winAmt);
      toast(`üéâ ${result.c.toUpperCase()} wins! +${fmt(winAmt)} tokens!`);
      if (result.c === 'green') confetti();
      addLiveFeed('You', `won ${fmt(winAmt)} on ${result.c} roulette`, 'üé∞', true);
    } else {
      toast(`‚ùå ${result.c.toUpperCase()} ‚Äî You lost ${fmt(bet)} tokens`, 'red');
      addLiveFeed('You', `lost ${fmt(bet)} on roulette`, 'üé∞', false);
    }
    
    document.getElementById('rouletteResult').innerHTML = `
      <span style="font-family:'Rajdhani';font-size:28px;font-weight:700;color:${won?'var(--green)':'var(--red)'}">
        ${won ? '‚úÖ WIN!' : '‚ùå LOSE'} ‚Äî ${result.c.toUpperCase()} ${result.n}
      </span>`;
    
    const hist = document.getElementById('rouletteHistory');
    hist.innerHTML = rouletteState.history.slice(0,8).map(h => 
      `<div style="width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;font-family:'Rajdhani';
        background:${h.c==='red'?'rgba(239,68,68,0.2)':h.c==='green'?'rgba(16,185,129,0.2)':'rgba(30,34,53,0.8)'};
        border:1px solid ${h.c==='red'?'rgba(239,68,68,0.4)':h.c==='green'?'rgba(16,185,129,0.4)':'rgba(100,100,120,0.4)'};
        color:${h.c==='red'?'var(--red)':h.c==='green'?'var(--green)':'var(--text2)'}">${h.n}</div>`
    ).join('');
  }, 6500);
}

// ============ DICE ============
let diceState = { rolling: false };

function updateDiceSlider() {
  const slider = document.getElementById('diceSlider');
  const mode = document.getElementById('diceMode').value;
  const val = parseInt(slider.value);
  
  let chance, mult;
  if (mode === 'under') {
    chance = (val - 1) / 100;
  } else {
    chance = (100 - val) / 100;
  }
  
  chance = Math.max(0.01, Math.min(0.99, chance));
  mult = 0.97 / chance;
  
  document.getElementById('diceChance').textContent = (chance * 100).toFixed(1) + '%';
  document.getElementById('diceMult').textContent = mult.toFixed(2) + '√ó';
  document.getElementById('diceTarget').textContent = val;
  slider.style.setProperty('--val', val + '%');
}

async function rollDice() {
  if (diceState.rolling) return;
  const bet = parseInt(document.getElementById('diceBet').value);
  if (!placeBet(bet)) return;
  
  diceState.rolling = true;
  document.getElementById('diceRollBtn').disabled = true;
  
  const display = document.getElementById('diceDisplay');
  display.classList.add('rolling');
  display.innerHTML = 'üé≤';
  
  const dice = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
  let count = 0;
  const interval = setInterval(() => {
    display.innerHTML = dice[rnd(0,5)];
    count++;
    if (count > 10) { clearInterval(interval); }
  }, 80);
  
  await new Promise(r => setTimeout(r, 1200));
  clearInterval(interval);
  display.classList.remove('rolling');
  
  const roll = rnd(1, 100);
  const target = parseInt(document.getElementById('diceSlider').value);
  const mode = document.getElementById('diceMode').value;
  
  const diceFaces = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
  display.innerHTML = diceFaces[rnd(0,5)];
  display.innerHTML = roll;
  display.style.fontFamily = 'Rajdhani';
  display.style.fontSize = '80px';
  display.style.fontWeight = '700';
  display.style.color = 'var(--text)';
  
  const won = mode === 'under' ? roll < target : roll > target;
  const chance = mode === 'under' ? (target-1)/100 : (100-target)/100;
  const mult = 0.97 / Math.max(0.01, chance);
  
  document.getElementById('diceResultText').textContent = `Rolled: ${roll} | Target: ${mode === 'under' ? 'Under' : 'Over'} ${target}`;
  
  const badge = document.getElementById('diceResultBadge');
  if (won) {
    const win = Math.floor(bet * mult);
    winBet(win);
    badge.innerHTML = `<div class="result-badge result-win">WIN +${fmt(win)}</div>`;
    if (mult > 5) confetti();
    addLiveFeed('You', `rolled ${roll} and won ${fmt(win)} tokens in dice`, 'üé≤', true);
  } else {
    badge.innerHTML = `<div class="result-badge result-lose">LOSE -${fmt(bet)}</div>`;
    addLiveFeed('You', `rolled ${roll} and lost ${fmt(bet)} tokens in dice`, 'üé≤', false);
  }
  
  const hist = document.getElementById('diceHistory');
  const tag = document.createElement('div');
  tag.className = `tag ${won ? 'tag-green' : 'tag-purple'}`;
  tag.style.background = won ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)';
  tag.style.borderColor = won ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)';
  tag.style.color = won ? 'var(--green)' : 'var(--red)';
  tag.textContent = roll;
  hist.insertBefore(tag, hist.firstChild);
  while (hist.children.length > 10) hist.removeChild(hist.lastChild);
  
  diceState.rolling = false;
  document.getElementById('diceRollBtn').disabled = false;
}

// ============ TOWER ============
let towerState = { active: false, currentRow: 0, bet: 0, safeRows: 0, grid: [], totalRows: 8 };

const TOWER_CONFIGS = {
  easy: { cols: 3, bombs: 1, multPerRow: 1.25 },
  medium: { cols: 3, bombs: 2, multPerRow: 1.5 },
  hard: { cols: 2, bombs: 1, multPerRow: 1.8 },
  expert: { cols: 2, bombs: 2, multPerRow: 2.5 }
};

function initTowerGrid() {
  const grid = document.getElementById('towerGrid');
  grid.innerHTML = '';
  const config = TOWER_CONFIGS[document.getElementById('towerDiff')?.value || 'medium'];
  const rows = 8;
  
  for (let r = rows - 1; r >= 0; r--) {
    const row = document.createElement('div');
    row.className = 'tower-row';
    row.id = 'tr-' + r;
    for (let c = 0; c < config.cols; c++) {
      const cell = document.createElement('div');
      cell.className = 'tower-cell';
      cell.innerHTML = '?';
      cell.onclick = () => clickTowerCell(r, c);
      cell.id = `tc-${r}-${c}`;
      const lv = document.createElement('span');
      lv.className = 'tower-level';
      if (c === 0) lv.textContent = `${r+1}x`;
      cell.appendChild(lv);
      row.appendChild(cell);
    }
    grid.appendChild(row);
  }
}

function startTower() {
  const bet = parseInt(document.getElementById('towerBet').value);
  if (!placeBet(bet)) return;
  
  const diff = document.getElementById('towerDiff').value;
  const config = TOWER_CONFIGS[diff];
  const rows = 8;
  
  towerState = { active: true, currentRow: 0, bet, safeRows: 0, grid: [], totalRows: rows, config };
  
  // Generate bomb positions for each row
  for (let r = 0; r < rows; r++) {
    const bombs = [];
    const cols = [...Array(config.cols).keys()];
    for (let b = 0; b < config.bombs; b++) {
      const idx = rnd(0, cols.length-1);
      bombs.push(cols[idx]);
      cols.splice(idx, 1);
    }
    towerState.grid.push(bombs);
  }
  
  // Reset all cells
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < config.cols; c++) {
      const cell = document.getElementById(`tc-${r}-${c}`);
      cell.className = 'tower-cell blocked';
      cell.innerHTML = '?';
    }
  }
  
  activateRow(0);
  document.getElementById('towerStartBtn').textContent = 'Restart';
  document.getElementById('towerCashoutBtn').style.display = 'block';
  document.getElementById('towerMultDisplay').style.display = 'block';
  updateTowerDisplay();
}

function activateRow(row) {
  const config = towerState.config;
  for (let c = 0; c < config.cols; c++) {
    const cell = document.getElementById(`tc-${row}-${c}`);
    cell.className = 'tower-cell active-row';
    cell.innerHTML = '?';
  }
}

function updateTowerDisplay() {
  const mult = Math.pow(towerState.config.multPerRow, towerState.safeRows);
  const win = Math.floor(towerState.bet * mult);
  document.getElementById('towerMultValue').textContent = mult.toFixed(2) + '√ó';
  document.getElementById('towerProfitValue').textContent = '+' + fmt(win) + ' tokens';
}

function clickTowerCell(row, col) {
  if (!towerState.active || row !== towerState.currentRow) return;
  
  const config = towerState.config;
  const isBomb = towerState.grid[row].includes(col);
  const cell = document.getElementById(`tc-${row}-${col}`);
  
  // Block row
  for (let c = 0; c < config.cols; c++) {
    const cc = document.getElementById(`tc-${row}-${c}`);
    cc.classList.remove('active-row');
    cc.classList.add('blocked');
  }
  
  if (isBomb) {
    cell.className = 'tower-cell bomb-hit';
    cell.innerHTML = 'üí£';
    
    // Reveal all bombs
    for (let r = 0; r < towerState.totalRows; r++) {
      if (r === row) continue;
      towerState.grid[r].forEach(bc => {
        const bc_ = document.getElementById(`tc-${r}-${bc}`);
        if (bc_) { bc_.innerHTML = 'üí£'; bc_.style.opacity='0.4'; }
      });
    }
    
    towerState.active = false;
    document.getElementById('towerCashoutBtn').style.display = 'none';
    document.getElementById('towerStartBtn').textContent = 'Play Again';
    toast('üí• Hit a bomb! Game over.', 'red');
    addLiveFeed('You', 'hit a bomb in Tower', 'üí£', false);
  } else {
    cell.className = 'tower-cell safe';
    cell.innerHTML = 'üíé';
    towerState.safeRows++;
    towerState.currentRow++;
    
    if (towerState.currentRow >= towerState.totalRows) {
      cashoutTower();
    } else {
      activateRow(towerState.currentRow);
      updateTowerDisplay();
    }
  }
}

function cashoutTower() {
  if (!towerState.active || towerState.safeRows === 0) return;
  towerState.active = false;
  const mult = Math.pow(towerState.config.multPerRow, towerState.safeRows);
  const win = Math.floor(towerState.bet * mult);
  winBet(win);
  document.getElementById('towerCashoutBtn').style.display = 'none';
  document.getElementById('towerStartBtn').textContent = 'Play Again';
  toast('üóº Cashed out ' + fmt(win) + ' tokens!');
  if (mult > 3) confetti();
  addLiveFeed('You', `cashed out ${fmt(win)} in Tower (${mult.toFixed(2)}x)`, 'üóº', true);
}

// ============ CASES ============
const CASES_DATA = [
  {
    name: 'Basic Case', emoji: 'üì¶', price: 100, rarity: 'Common', rarityColor: '#6b7280',
    items: [
      { name: 'Fragment', emoji: 'üî∑', value: 20, weight: 40, rarity: 'Common', rarityColor: '#6b7280' },
      { name: 'Crystal', emoji: 'üíé', value: 80, weight: 30, rarity: 'Uncommon', rarityColor: '#10b981' },
      { name: 'Ruby', emoji: 'üî¥', value: 150, weight: 15, rarity: 'Rare', rarityColor: '#3b82f6' },
      { name: 'Sapphire', emoji: 'üîµ', value: 300, weight: 10, rarity: 'Epic', rarityColor: '#8b5cf6' },
      { name: 'Diamond', emoji: '‚ú®', value: 1000, weight: 5, rarity: 'Legendary', rarityColor: '#f59e0b' },
    ]
  },
  {
    name: 'Rare Case', emoji: 'üéÅ', price: 500, rarity: 'Rare', rarityColor: '#3b82f6',
    items: [
      { name: 'Gem', emoji: 'üí†', value: 150, weight: 35, rarity: 'Common', rarityColor: '#6b7280' },
      { name: 'Topaz', emoji: 'üü°', value: 400, weight: 25, rarity: 'Uncommon', rarityColor: '#10b981' },
      { name: 'Emerald', emoji: 'üíö', value: 800, weight: 20, rarity: 'Rare', rarityColor: '#3b82f6' },
      { name: 'Amethyst', emoji: 'üü£', value: 1500, weight: 12, rarity: 'Epic', rarityColor: '#8b5cf6' },
      { name: 'Star Ruby', emoji: '‚≠ê', value: 5000, weight: 8, rarity: 'Legendary', rarityColor: '#f59e0b' },
    ]
  },
  {
    name: 'Epic Case', emoji: 'üåü', price: 1000, rarity: 'Epic', rarityColor: '#8b5cf6',
    items: [
      { name: 'Prism', emoji: 'üîÆ', value: 400, weight: 30, rarity: 'Common', rarityColor: '#6b7280' },
      { name: 'Phoenix Stone', emoji: 'üî•', value: 1000, weight: 25, rarity: 'Uncommon', rarityColor: '#10b981' },
      { name: 'Void Crystal', emoji: 'üåë', value: 2500, weight: 20, rarity: 'Rare', rarityColor: '#3b82f6' },
      { name: 'Cosmic Gem', emoji: 'üåå', value: 6000, weight: 18, rarity: 'Epic', rarityColor: '#8b5cf6' },
      { name: 'God Stone', emoji: 'üëë', value: 20000, weight: 7, rarity: 'Legendary', rarityColor: '#f59e0b' },
    ]
  },
  {
    name: 'Legendary Case', emoji: 'üí´', price: 2500, rarity: 'Legendary', rarityColor: '#f59e0b',
    items: [
      { name: 'Star Dust', emoji: '‚ú®', value: 1000, weight: 25, rarity: 'Common', rarityColor: '#6b7280' },
      { name: 'Celestial', emoji: 'üå†', value: 3000, weight: 25, rarity: 'Uncommon', rarityColor: '#10b981' },
      { name: 'Galactic', emoji: 'üåÄ', value: 7500, weight: 20, rarity: 'Rare', rarityColor: '#3b82f6' },
      { name: 'Infinity', emoji: '‚ôæÔ∏è', value: 15000, weight: 20, rarity: 'Epic', rarityColor: '#8b5cf6' },
      { name: 'JACKPOT', emoji: 'üí∞', value: 100000, weight: 10, rarity: 'Legendary', rarityColor: '#f59e0b' },
    ]
  }
];

let selectedCase = null;
let caseOpening = false;

function initCases() {
  const grid = document.getElementById('caseGrid');
  grid.innerHTML = '';
  CASES_DATA.forEach((c, idx) => {
    const div = document.createElement('div');
    div.className = 'case-item';
    div.style.setProperty('--rarity-color', c.rarityColor);
    div.innerHTML = `
      <div class="case-emoji">${c.emoji}</div>
      <div class="rarity-label" style="color:${c.rarityColor}">${c.rarity}</div>
      <div class="case-name">${c.name}</div>
      <div class="case-price">ü™ô ${fmt(c.price)}</div>
    `;
    div.onclick = () => selectCase(idx);
    grid.appendChild(div);
  });
}

function selectCase(idx) {
  selectedCase = idx;
  const c = CASES_DATA[idx];
  document.getElementById('caseSelectView').style.display = 'none';
  document.getElementById('caseOpenView').style.display = 'block';
  document.getElementById('caseOpenTitle').textContent = c.emoji + ' ' + c.name;
  document.getElementById('casePriceDisplay').textContent = 'ü™ô ' + fmt(c.price);
  
  const contents = document.getElementById('caseContents');
  contents.innerHTML = c.items.map(item => `
    <div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--bg3);border-radius:8px;border:1px solid var(--border);border-bottom:2px solid ${item.rarityColor}">
      <span style="font-size:22px">${item.emoji}</span>
      <div>
        <div style="font-size:13px;font-weight:600;">${item.name}</div>
        <div style="font-size:11px;color:${item.rarityColor};font-weight:700;">${item.rarity} ‚Äî ü™ô${fmt(item.value)}</div>
      </div>
    </div>
  `).join('');
  
  document.getElementById('openAnimWrapper').style.display = 'none';
  document.getElementById('openResult').style.display = 'none';
}

function backToCases() {
  document.getElementById('caseSelectView').style.display = 'block';
  document.getElementById('caseOpenView').style.display = 'none';
}

function pickCaseItem(caseIdx) {
  const c = CASES_DATA[caseIdx];
  const totalWeight = c.items.reduce((a, b) => a + b.weight, 0);
  let rand = Math.random() * totalWeight;
  for (const item of c.items) {
    rand -= item.weight;
    if (rand <= 0) return item;
  }
  return c.items[c.items.length - 1];
}

function openCase(multi = false) {
  if (caseOpening) return;
  if (selectedCase === null) return;
  
  const c = CASES_DATA[selectedCase];
  const count = multi ? 5 : 1;
  const cost = c.price * count;
  
  if (!placeBet(cost)) return;
  caseOpening = true;
  
  const wrapper = document.getElementById('openAnimWrapper');
  const track = document.getElementById('openTrack');
  const result = document.getElementById('openResult');
  
  wrapper.style.display = 'block';
  result.style.display = 'none';
  track.style.transition = 'none';
  track.style.transform = 'translateX(0)';
  
  // Build track items
  const winItem = pickCaseItem(selectedCase);
  const totalItems = 60;
  const winIdx = 50;
  
  let items = '';
  for (let i = 0; i < totalItems; i++) {
    let item = i === winIdx ? winItem : c.items[rnd(0, c.items.length-1)];
    items += `<div class="open-item" style="border-color:${item.rarityColor}20;background:linear-gradient(135deg,${item.rarityColor}10,transparent)">
      <span style="font-size:32px">${item.emoji}</span>
      <span style="font-size:10px;color:${item.rarityColor};font-weight:700;font-family:'DM Sans'">${item.rarity}</span>
    </div>`;
  }
  track.innerHTML = items;
  
  setTimeout(() => {
    const itemWidth = 108;
    const containerWidth = wrapper.offsetWidth;
    const targetX = -(winIdx * itemWidth - containerWidth/2 + 50);
    track.style.transition = 'transform 5s cubic-bezier(0.1, 0.5, 0.2, 1)';
    track.style.transform = `translateX(${targetX}px)`;
  }, 50);
  
  setTimeout(() => {
    caseOpening = false;
    winBet(winItem.value);
    
    result.style.display = 'block';
    result.innerHTML = `
      <div style="padding:24px;background:linear-gradient(135deg,${winItem.rarityColor}15,transparent);border:1px solid ${winItem.rarityColor}40;border-radius:12px;">
        <div style="font-size:52px;margin-bottom:8px">${winItem.emoji}</div>
        <div style="font-family:'Rajdhani';font-size:26px;font-weight:700;margin-bottom:4px;">${winItem.name}</div>
        <div style="color:${winItem.rarityColor};font-weight:700;font-size:13px;letter-spacing:1px;margin-bottom:12px;">${winItem.rarity.toUpperCase()}</div>
        <div style="font-family:'Rajdhani';font-size:36px;font-weight:700;color:var(--gold)">ü™ô ${fmt(winItem.value)}</div>
      </div>`;
    
    if (winItem.weight <= 10) confetti();
    const profit = winItem.value - cost;
    toast(profit > 0 ? `+${fmt(profit)} profit! üéâ` : `${fmt(-profit)} loss`, profit > 0 ? 'green' : 'red');
    addLiveFeed('You', `opened ${c.name} and got ${winItem.name}`, c.emoji, winItem.value >= c.price);
  }, 5500);
}

// ============ CASE BATTLE ============
const BATTLE_CASES = [0, 1, 2, 3];
let battleState = { running: false };

function updateBattleCost() {
  const caseIdx = parseInt(document.getElementById('battleCaseSelect').value);
  const count = parseInt(document.getElementById('battleCaseCount').value);
  const cost = CASES_DATA[caseIdx].price * count;
  document.getElementById('battleCost').textContent = 'ü™ô ' + fmt(cost);
}

document.getElementById('battleCaseSelect')?.addEventListener('change', updateBattleCost);
document.getElementById('battleCaseCount')?.addEventListener('change', updateBattleCost);

async function startBattle() {
  if (battleState.running) return;
  
  const caseIdx = parseInt(document.getElementById('battleCaseSelect').value);
  const count = parseInt(document.getElementById('battleCaseCount').value);
  const cost = CASES_DATA[caseIdx].price * count;
  
  if (!placeBet(cost)) return;
  battleState.running = true;
  
  const c = CASES_DATA[caseIdx];
  document.getElementById('battleItems1').innerHTML = '';
  document.getElementById('battleItems2').innerHTML = '';
  document.getElementById('battleTotal1').textContent = 'ü™ô 0';
  document.getElementById('battleTotal2').textContent = 'ü™ô 0';
  document.getElementById('battleResult').innerHTML = '';
  document.getElementById('battlePlayer1').className = 'battle-player';
  document.getElementById('battlePlayer2').className = 'battle-player';
  
  let p1Total = 0, p2Total = 0;
  
  for (let i = 0; i < count; i++) {
    await new Promise(r => setTimeout(r, 600));
    
    const item1 = pickCaseItem(caseIdx);
    const item2 = pickCaseItem(caseIdx);
    p1Total += item1.value;
    p2Total += item2.value;
    
    const div1 = document.createElement('div');
    div1.className = 'battle-item';
    div1.style.borderColor = item1.rarityColor + '40';
    div1.innerHTML = `<span style="font-size:24px">${item1.emoji}</span>`;
    div1.title = item1.name + ' ‚Äî ü™ô' + fmt(item1.value);
    document.getElementById('battleItems1').appendChild(div1);
    
    const div2 = document.createElement('div');
    div2.className = 'battle-item';
    div2.style.borderColor = item2.rarityColor + '40';
    div2.innerHTML = `<span style="font-size:24px">${item2.emoji}</span>`;
    div2.title = item2.name + ' ‚Äî ü™ô' + fmt(item2.value);
    document.getElementById('battleItems2').appendChild(div2);
    
    document.getElementById('battleTotal1').textContent = 'ü™ô ' + fmt(p1Total);
    document.getElementById('battleTotal2').textContent = 'ü™ô ' + fmt(p2Total);
  }
  
  await new Promise(r => setTimeout(r, 800));
  
  const youWon = p1Total > p2Total;
  
  if (youWon) {
    winBet(cost * 2);
    document.getElementById('battlePlayer1').className = 'battle-player winner';
    document.getElementById('battleResult').innerHTML = `
      <div class="result-badge result-win" style="margin-top:16px;display:inline-block">YOU WIN! +${fmt(cost)} profit üéâ</div>`;
    confetti();
    addLiveFeed('You', `won a case battle! +${fmt(cost)} profit`, '‚öîÔ∏è', true);
  } else if (p1Total === p2Total) {
    winBet(cost);
    document.getElementById('battleResult').innerHTML = `
      <div class="result-badge" style="background:rgba(108,99,255,0.2);border:2px solid var(--accent);color:var(--accent);margin-top:16px;display:inline-block">TIE ‚Äî Refunded!</div>`;
  } else {
    document.getElementById('battlePlayer2').className = 'battle-player winner';
    document.getElementById('battleResult').innerHTML = `
      <div class="result-badge result-lose" style="margin-top:16px;display:inline-block">Bot Wins! -${fmt(cost)} tokens üò¢</div>`;
    addLiveFeed('You', `lost a case battle (-${fmt(cost)} tokens)`, '‚öîÔ∏è', false);
  }
  
  battleState.running = false;
}

// ============ LIVE FEED SIMULATION ============
const FAKE_NAMES = ['xSlayer','CryptoK','NightH','Lucky7','SilverF','ThunderB','ViperX','GhostKing'];
const FAKE_GAMES = ['üíé Mines','üé∞ Roulette','üé≤ Dice','üóº Tower','üì¶ Cases','üé° Jackpot'];

function simulateLiveFeed() {
  setInterval(() => {
    if (Math.random() > 0.4) {
      const name = FAKE_NAMES[rnd(0, FAKE_NAMES.length-1)];
      const game = FAKE_GAMES[rnd(0, FAKE_GAMES.length-1)];
      const won = Math.random() > 0.45;
      const amount = rnd(1, 500) * 10;
      addLiveFeed(name, (won ? 'won ' : 'lost ') + fmt(amount) + ' on ' + game, game.split(' ')[0], won);
    }
  }, 3000);
}

// ============ INIT ============
window.onload = function() {
  initMinesGrid();
  initRouletteTrack();
  initTowerGrid();
  initCases();
  updateDiceSlider();
  updateBalance();
  simulateLiveFeed();
  
  // Add some initial live feed entries
  setTimeout(() => addLiveFeed('CryptoK', 'won 5,200 on Mines', 'üíé', true), 500);
  setTimeout(() => addLiveFeed('Lucky7', 'lost 300 on Roulette', 'üé∞', false), 1200);
  setTimeout(() => addLiveFeed('xSlayer', 'won 18,000 on Jackpot', 'üé°', true), 2000);
};
</script>
</body>
</html>
